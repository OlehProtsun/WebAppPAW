// safeJsonParse — утиліта для "безпечного" парсингу JSON.
//
// Призначення:
// - не падати з винятком, якщо рядок порожній/NULL або містить невалідний JSON
// - у таких випадках повертати fallback (дефолтне значення)
//
// Тип T робить функцію універсальною:
// можна парсити будь-яку очікувану структуру (масив, об’єкт тощо),
// і при цьому отримувати типізований результат.
export function safeJsonParse<T>(value: string | null, fallback: T): T {
  // Якщо значення відсутнє (null) або порожній рядок — одразу повертаємо fallback.
  // Це типова ситуація, коли ключ у сховищі ще не створений.
  if (!value) return fallback;

  try {
    // JSON.parse може кинути помилку, якщо рядок не є валідним JSON.
    // Тут ми пробуємо розпарсити та приводимо результат до типу T.
    //
    // Важливо розуміти: `as T` — це лише підказка TypeScript.
    // В runtime це НЕ перевіряє структуру даних (нема валідації схеми).
    return JSON.parse(value) as T;
  } catch {
    // Якщо JSON зламаний/пошкоджений/неочікуваний — повертаємо fallback,
    // щоб додаток міг продовжити роботу без крешу.
    return fallback;
  }
}